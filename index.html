<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kimi Antonelli Latest News</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="styles.css">

</head>

<body>
  <header class="header">
    <div class="header-container">
      <h1>Kimi Antonelli Latest News</h1>
      <div class="nav-wrapper">
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="#" class="nav-link active">News</a>
          </li>
          <li class="nav-item">
            <a href="reddit.html" class="nav-link">Kimi on REDDIT</a>
          </li>
          <li class="nav-item">
            <a href="memes.html" class="nav-link">MEMES</a>
          </li>
          <li class="nav-item">
            <a href="about.html" class="nav-link">About</a>
          </li>
        </ul>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="articles-grid" id="newsContainer">
      <div class="loading">Loading Kimi Antonelli news...</div>
    </div>
  </main>

  <script>
    const workerURL = 'https://kimi2.malasadi578.workers.dev/';
    const placeholderImage = 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2071&q=80';
    const CACHE_KEY = 'kimiAntonelliNewsCache';
    const CACHE_TIME_KEY = 'kimiAntonelliNewsCacheTime';
    const CACHE_TTL_MS = 5 * 60 * 1000;

    function stripHTML(html) {
      const div = document.createElement("div");
      div.innerHTML = html;
      return div.textContent || div.innerText || "";
    }

    document.addEventListener('DOMContentLoaded', function() {
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          if (this.classList.contains('disabled')) {
            e.preventDefault();
            return;
          }
          if (this.getAttribute('href') === 'reddit.html') return;
          if (this.getAttribute('href') === '#') e.preventDefault();
          navLinks.forEach(l => l.classList.remove('active'));
          if (!this.classList.contains('disabled')) this.classList.add('active');
        });
      });
    });

    async function loadArticles() {
      const container = document.getElementById('newsContainer');
      container.innerHTML = '<div class="loading">Scanning the latest Kimi Antonelli news. PLEASE BE PATIENT </div>';

      let articles = [];

      // ---- 5-minute localStorage cache (use if fresh, else fetch) ----
      try {
        const cachedJSON = localStorage.getItem(CACHE_KEY);
        const cachedTime = localStorage.getItem(CACHE_TIME_KEY);
        if (cachedJSON && cachedTime && (Date.now() - parseInt(cachedTime, 10) < CACHE_TTL_MS)) {
          const cachedData = JSON.parse(cachedJSON);
          if (Array.isArray(cachedData) && cachedData.length > 0) {
            articles = cachedData;
            container.innerHTML = '';
            articles.forEach(article => {
              if (article.title && /kimi antonelli|antonelli/i.test(article.title)  
               && article.link!="https://news.google.com/rss/articles/CBMihwFBVV95cUxQUHJVRG5qbTd1U1J1YXVYUjBNVTE0MnFxZUNJUjllNzF4MjlWU0hpT2hxczUyZ1Qyd0NGb19lbUxYUkE0aDBuNjktaEZYZGxpcUFsOVVwcElhRVJPbGlHMW5rZmJCalpoYWJIbFRxSDBFOGFnaU5VS1g4bFVBVVp2dWtEMkR4Szg?oc=5"  
               && article.link!="https://news.google.com/rss/articles/CBMiUkFVX3lxTE5XMXZ2cEw5VXF3MDR4czBrbXZIZHlqRXhIVWtzN0VtWXJ6N0RxRWR1UGJfT1RyeV9pMkY0ejEzemR3Y3VHVi1vQUNoVEZmX1RxdnfSAVdBVV95cUxQN2tMbHBJbmVfcm4waldyOXlqc2psdm43SWRKdENYUUZhRmRMb1BDNjRaS0RyZklib2RSLTBFM2c0TGMwZ1AyNk1RdnZyRGVYbGM4OUd5cGc?oc=5"
               && article.link!= "https://news.google.com/rss/articles/CBMiowFBVV95cUxQbGw4TDBJYThkMDhwZjdkUFFhaXZkSWRydzNlUlUtRVZlRXU5bldjMl9aS1M3R2V1X2hjYWtPOTkxWkhGM2ZkUFpUdFNxMWQ1MEZpd3k4SnM3MVVjNW0zQkRoYmphMmp6RGZJWlBHX0VkMDM1WVZGSzRKWHNDWTNSaTVDTkFkcHhxWmJtVFNVTGkycEhiOFVNZ2xxWVBxV0dhQ3NN?oc=5"
              && article.link!= "https://news.google.com/rss/articles/CBMimgFBVV95cUxQVXQzTEVHQ1dEVlNxaTA0V0l4YmU5SG5RTnVFYkJ1cTU2Zm1SM3gyYmMyQmY1SjFWV2tlbDZYLVNidUZENWhZTlR6N1RFZllLbDFDRUh3Y3NScnlfZHlqUHJFMy02VkZudFMtZ0MzQ0ZUS3M4QU1zeW9qbC11SnNyakJSYVJ4ZXZpX0ljVEJRTzE4WFVDT29tZS1B?oc=5"

               
                    ) {
                const articleElement = document.createElement('article');
                articleElement.className = 'article-card';
                const cleanDescription = stripHTML(article.description).slice(0, 140) + "...";
                const formattedDate = article.pubDate
                  ? new Date(article.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
                  : '';
                const imageUrl = article.image || placeholderImage;

                articleElement.innerHTML = `
                  <div class="article-image">
                    <img src="${imageUrl}" alt="${article.title}" loading="lazy">
                  </div>
                  <div class="article-content">
                    <div class="article-text-content">
                      <div class="article-meta">${formattedDate}</div>
                      <h2 class="article-title">
                        <a href="${article.link}" target="_blank">${article.title}</a>
                      </h2>
                      <p class="article-excerpt">${cleanDescription}</p>
                    </div>
                    <div class="article-actions">
                      <a href="${article.link}" target="_blank" class="read-more">Read Article</a>
                    </div>
                  </div>
                `;
                container.appendChild(articleElement);
              }
            });
            return;
          }
        }
      } catch (e) {
        console.error('Cache read failed, proceeding to fetch:', e);
      }
      // ---- end cache-read path ----

      try {
        const response = await fetch(workerURL);
        let data;
        try {
          data = await response.json();
        } catch (jsonErr) {
          console.error('Failed to parse JSON:', jsonErr);
          container.innerHTML = '<div class="error">Error parsing news data. Please try again later.</div>';
          return;
        }

        if (Array.isArray(data)) articles = data;
      } catch (fetchErr) {
        console.error('Error fetching articles:', fetchErr);
        container.innerHTML = '<div class="error">Error loading news. Please try again later.</div>';
        return;
      }

      if (!Array.isArray(articles) || articles.length === 0) {
        container.innerHTML = '<div class="error">No articles found about Kimi Antonelli.</div>';
        return;
      }

      // Store fresh data in cache with timestamp
      try {
        localStorage.setItem(CACHE_KEY, JSON.stringify(articles));
        localStorage.setItem(CACHE_TIME_KEY, String(Date.now()));
      } catch (e) {
        console.error('Failed to write cache:', e);
      }

      container.innerHTML = '';

      articles.forEach(article => {
        if (article.title && /kimi antonelli|antonelli/i.test(article.title)    && article.link!="https://news.google.com/rss/articles/CBMihwFBVV95cUxQUHJVRG5qbTd1U1J1YXVYUjBNVTE0MnFxZUNJUjllNzF4MjlWU0hpT2hxczUyZ1Qyd0NGb19lbUxYUkE0aDBuNjktaEZYZGxpcUFsOVVwcElhRVJPbGlHMW5rZmJCalpoYWJIbFRxSDBFOGFnaU5VS1g4bFVBVVp2dWtEMkR4Szg?oc=5"
        && article.link!="https://news.google.com/rss/articles/CBMiowFBVV95cUxQbGw4TDBJYThkMDhwZjdkUFFhaXZkSWRydzNlUlUtRVZlRXU5bldjMl9aS1M3R2V1X2hjYWtPOTkxWkhGM2ZkUFpUdFNxMWQ1MEZpd3k4SnM3MVVjNW0zQkRoYmphMmp6RGZJWlBHX0VkMDM1WVZGSzRKWHNDWTNSaTVDTkFkcHhxWmJtVFNVTGkycEhiOFVNZ2xxWVBxV0dhQ3NN?oc=5"
        && article.link!="https://news.google.com/rss/articles/CBMiUkFVX3lxTE5XMXZ2cEw5VXF3MDR4czBrbXZIZHlqRXhIVWtzN0VtWXJ6N0RxRWR1UGJfT1RyeV9pMkY0ejEzemR3Y3VHVi1vQUNoVEZmX1RxdnfSAVdBVV95cUxQN2tMbHBJbmVfcm4waldyOXlqc2psdm43SWRKdENYUUZhRmRMb1BDNjRaS0RyZklib2RSLTBFM2c0TGMwZ1AyNk1RdnZyRGVYbGM4OUd5cGc?oc=5"
        
            ) {
          const articleElement = document.createElement('article');
          articleElement.className = 'article-card';
          const cleanDescription = stripHTML(article.description).slice(0, 140) + "...";
          const formattedDate = article.pubDate
            ? new Date(article.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
            : '';
          const imageUrl = article.image || placeholderImage;

          articleElement.innerHTML = `
            <div class="article-image">
              <img src="${imageUrl}" alt="${article.title}" loading="lazy">
            </div>
            <div class="article-content">
              <div class="article-text-content">
                <div class="article-meta">${formattedDate}</div>
                <h2 class="article-title">
                  <a href="${article.link}" target="_blank">${article.title}</a>
                </h2>
                <p class="article-excerpt">${cleanDescription}</p>
              </div>
              <div class="article-actions">
                <a href="${article.link}" target="_blank" class="read-more">Read Article</a>
              </div>
            </div>
          `;
          container.appendChild(articleElement);
        }
      });
    }

    loadArticles();
  </script>
</body>
</html>
