<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reddit posts that mention Kimi </title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
  /* ... your CSS unchanged ... */
</style>
</head>
<body>
  <header class="header">
    <div class="header-container">
      <h1> Latest Reddit posts that mention Kimi ðŸ¤“ </h1>
      <div class="nav-wrapper">
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="index.html" class="nav-link">News</a>
          </li>
          <li class="nav-item">
            <a href="reddit.html" class="nav-link active">Kimi on REDDIT</a>
          </li>
          <li class="nav-item">
            <a href="memes.html" class="nav-link">MEMES</a>
          </li>
          <li class="nav-item">
              <a href="about.html" class="nav-link">About</a>
          </li>
        </ul>
      </div>
    </div>
  </header>
  
  <main class="container">
    <div class="posts-grid" id="reddit-posts"></div>
  </main>

  <script>
    const REDDIT_CACHE_KEY = 'kimiRedditCache';
    const REDDIT_CACHE_TIME_KEY = 'kimiRedditCacheTime';
    const REDDIT_CACHE_TTL_MS = 5 * 60 * 1000;

    async function fetchRedditPosts() {
      const container = document.getElementById("reddit-posts");

      // ---- cache check ----
      try {
        const cachedJSON = localStorage.getItem(REDDIT_CACHE_KEY);
        const cachedTime = localStorage.getItem(REDDIT_CACHE_TIME_KEY);
        if (cachedJSON && cachedTime && (Date.now() - parseInt(cachedTime, 10) < REDDIT_CACHE_TTL_MS)) {
          const cachedPosts = JSON.parse(cachedJSON);
          if (Array.isArray(cachedPosts) && cachedPosts.length > 0) {
            cachedPosts.forEach(post => {
              const card = document.createElement("article");
              card.className = "post-card";

              card.innerHTML = `
                <div class="post-content">
                  <div class="post-text-content">
                    <div class="post-meta">Reddit Post</div>
                    <h2 class="post-title"><a href="${post.link}" target="_blank" rel="noopener noreferrer">${post.title}</a></h2>
                  </div>
                  <div class="post-actions">
                    <a href="${post.link}" target="_blank" rel="noopener noreferrer" class="view-reddit">View on Reddit</a>
                  </div>
                </div>
              `;

              container.appendChild(card);
            });
            return; // âœ… use cache, skip network
          }
        }
      } catch (e) {
        console.error("Cache read failed, falling back to fetch:", e);
      }
      // ---- end cache check ----

      try {
        const res = await fetch("https://kimi2.malasadi578.workers.dev/reddit");
        if (!res.ok) throw new Error("Failed to fetch posts");
        const posts = await res.json();

        // save to cache
        try {
          localStorage.setItem(REDDIT_CACHE_KEY, JSON.stringify(posts));
          localStorage.setItem(REDDIT_CACHE_TIME_KEY, String(Date.now()));
        } catch (e) {
          console.error("Cache write failed:", e);
        }

        posts.forEach(post => {
          const card = document.createElement("article");
          card.className = "post-card";

          card.innerHTML = `
            <div class="post-content">
              <div class="post-text-content">
                <div class="post-meta">Reddit Post</div>
                <h2 class="post-title"><a href="${post.link}" target="_blank" rel="noopener noreferrer">${post.title}</a></h2>
              </div>
              <div class="post-actions">
                <a href="${post.link}" target="_blank" rel="noopener noreferrer" class="view-reddit">View on Reddit</a>
              </div>
            </div>
          `;

          container.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        container.innerHTML = '<div class="post-card"><div class="post-content"><div class="post-title">Error loading Reddit posts. Please try again later.</div></div></div>';
      }
    }

    fetchRedditPosts();
  </script>
</body>
</html>
